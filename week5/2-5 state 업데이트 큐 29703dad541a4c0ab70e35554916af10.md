# 2-5. state ì—…ë°ì´íŠ¸ í

ì‘ì„±ì: sikiy
ë‚ ì§œ: 2024ë…„ 5ì›” 15ì¼

# ê°œìš”

state ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ë©´ ë‹¤ìŒ ë Œë”ë§ì´ íì— ë“¤ì–´ê°„ë‹¤. ê·¸ëŸ¬ë‚˜ ë•Œì— ë”°ë¼ ë‹¤ìŒ ë Œë”ë§ì„ íì— ë„£ê¸° ì „ì—, ê°’ì— ëŒ€í•´ ì—¬ëŸ¬ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³  ì‹¶ì„ ë•Œë„ ìˆë‹¤. ì´ë¥¼ ìœ„í•´ì„  Reactê°€ stateì—…ë°ì´íŠ¸ë¥¼ ì–´ë–»ê²Œ ë°°ì¹˜í•˜ë©´ ì¢‹ì„ì§€ ì´í•´í•˜ëŠ” ê²ƒì´ ë„ì›€ì´ ëœë‹¤.

## í•™ìŠµ ë‚´ìš©

- â€œbatchingâ€ì´ë€ ë¬´ì—‡ì´ë©°, Reactê°€ ì—¬ëŸ¬ state ì—…ë°ì´íŠ¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•
- ë™ì¼í•œ state ë³€ìˆ˜ì—ì„œ ì—¬ëŸ¬ ì—…ë°ì´íŠ¸ë¥¼ ì—°ì†ìœ¼ë¡œ ì ìš©í•˜ëŠ” ë°©ë²•

## React state batches ì—…ë°ì´íŠ¸

setNumber(number + 1)ë¥¼ ì„¸ ë²ˆ í˜¸ì¶œí•˜ë¯€ë¡œ â€œ+3â€ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì„¸ ë²ˆ ì¦ê°€í•  ê²ƒìœ¼ë¡œ ì˜ˆìƒí•  ìˆ˜ ìˆë‹¤.

- ì½”ë“œ
    
    ```jsx
    import { useState } from 'react';
    
    export default function Counter() {
      const [number, setNumber] = useState(0);
    
      return (
        <>
          <h1>{number}</h1>
          <button onClick={() => {
            setNumber(number + 1);
            setNumber(number + 1);
            setNumber(number + 1);
          }}>+3</button>
        </>
      )
    }
    ```
    

ì´ì „ ì„¸ì…˜ì—ì„œ ê¸°ì–µí•  ìˆ˜ ìˆë“¯ ê° ë Œë”ë§ stateê°’ì€ ê³ ì •ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, ì²« ë²ˆì§¸ ë Œë”ë§ì˜ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì˜ `number`ê°’ì€ `setNumber(1)`ì„ ëª‡ ë²ˆ í˜¸ì¶œí•˜ë“  í•­ìƒ 0ì´ë‹¤.

```jsx
setNumber(0 + 1)
setNumber(0 + 1)
setNumber(0 + 1)
```

í•˜ì§€ë§Œ ì—¬ê¸°ì—ëŠ” í•œê°€ì§€ ìš”ì¸ì´ ë” ìˆë‹¤. ReactëŠ” stateë¥¼ ì—…ë°ì´íŠ¸ í•˜ê¸° ì „ì— ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì˜ ëª¨ë“  ì½”ë“œê°€ ì‹¤í–‰ë  ë•Œ ê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤. ì´ ë•Œë¬¸ì— ë¦¬ë Œë”ë§ì€ ëª¨ë“  `setNumber()` í˜¸ì¶œì´ ì™„ë£Œëœ ì´í›„ì—ë§Œ ì¼ì–´ë‚œë‹¤.

ì´ëŠ” ìŒì‹ì ì—ì„œ ì£¼ë¬¸ ë°›ëŠ” ì›¨ì´í„°ë¥¼ ìƒê°í•´ë³¼ ìˆ˜ ìˆë‹¤. ì›¨ì´í„°ëŠ” ì²« ë²ˆì§¸ ìš”ë¦¬ë¥¼ ë§í•˜ìë§ˆì ì£¼ë°©ìœ¼ë¡œ ë‹¬ë ¤ê°€ì§€ ì•ŠëŠ”ë‹¤. ëŒ€ì‹  ì£¼ë¬¸ì´ ëë‚ ë•Œê¹Œì§€ ê¸°ë‹¤ë ¸ë‹¤ê°€ ì£¼ë¬¸ì„ ë³€ê²½í•˜ê³ , ì‹¬ì§€ì–´ í…Œì´ë¸”ì— ìˆëŠ” ë‹¤ë¥¸ì‚¬ëŒì˜ ì£¼ë¬¸ë„ ë°›ëŠ”ë‹¤.

![Untitled](2-5%20state%20%E1%84%8B%E1%85%A5%E1%86%B8%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%B3%20%E1%84%8F%E1%85%B2%2029703dad541a4c0ab70e35554916af10/Untitled.png)

ì´ë ‡ê²Œ í•˜ë©´ ë„ˆë¬´ ë§ì€ ë¦¬ë Œë”ë§ì´ ë°œìƒí•˜ì§€ ì•Šê³ ë„ ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë‚˜ì˜¨ ë‹¤ìˆ˜ì˜ state ë³€ìˆ˜ë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ì´ëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì™€ ê·¸ ì•ˆì— ìˆëŠ” ì½”ë“œê°€ ì™„ë£Œë  ë•Œ ê¹Œì§€ UIê°€ ì—…ë°ì´íŠ¸ ë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì˜ë¯¸ì´ê¸°ë„ í•˜ë‹¤. batchingì´ë¼ê³ ë„ í•˜ëŠ” ì´ ë™ì‘ì€ React ì•±ì„ í›¨ì”¬ ë¹ ë¥´ê²Œ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤. ë˜í•œ ì¼ë¶€ ë³€ìˆ˜ë§Œ ì—…ë°ì´íŠ¸ëœ â€œë°˜ì¯¤ ì™„ì„±ëœâ€ í˜¼ë€ìŠ¤ëŸ¬ìš´ ë Œë”ë§ì„ ì²˜ë¦¬í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

ReactëŠ” í´ë¦­ê³¼ ê°™ì€ ì—¬ëŸ¬ ì˜ë„ì ì¸ ì´ë²¤íŠ¸ì— ëŒ€í•´ batchí•˜ì§€ ì•Šìœ¼ë©°, ê° í´ë¦­ì€ ê°œë³„ì ìœ¼ë¡œ ì²˜ë¦¬ëœë‹¤. ReactëŠ” ì•ˆì „í•œ ê²½ìš°ì—ë§Œ batchë¥¼ ìˆ˜í–‰í•˜ë‹ˆ ì•ˆì‹¬í•˜ì. ì˜ˆë¥¼ ë“¤ì–´ ì²« ë²ˆì§¸ ë²„íŠ¼ í´ë¦­ìœ¼ë¡œ ì–‘ì‹ì´ ë¹„í™œì„±í™” ë˜ë©´ ë‘ ë²ˆì§¸ í´ë¦­ìœ¼ë¡œ ì–‘ì‹ì´ ë‹¤ì‹œ ì œì¶œë˜ì§€ ì•Šë„ë¡ ë³´ì¥í•œë‹¤.

## ë‹¤ìŒ ë Œë”ë§ ì „ì— ë™ì¼í•œ stateë³€ìˆ˜ë¥¼ ì—¬ëŸ¬ ë²ˆ ì—…ë°ì´íŠ¸ í•˜ê¸°

í”í•œ ì‚¬ë¡€ëŠ” ì•„ë‹ˆì§€ë§Œ, ë‹¤ìŒ ë Œë”ë§ ì „ì— ë™ì¼í•œ stateë³€ìˆ˜ë¥¼ ì—¬ëŸ¬ ë²ˆ ì—…ë°ì´íŠ¸ í•˜ê³  ì‹¶ë‹¤ë©´ `setNumber(number + 1)`ì™€ ê°™ì´ ì“°ì§€ ë§ê³  `setNumber(n => n + 1)`ê³¼ ê°™ì´ ì´ì „ íì˜ stateë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‹¤ìŒ stateë¥¼ ê³„ì‚°í•˜ë„ë¡ í•˜ë©´ ëœë‹¤. ì´ëŠ” ë‹¨ìˆœíˆ state ê°’ì„ ëŒ€ì²´í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ Reactì— â€œstate ê°’ìœ¼ë¡œ ë¬´ì–¸ê°€ë¥¼ í•˜ë¼â€ê³  ì§€ì‹œí•˜ëŠ” ë°©ë²•ì´ë‹¤.

- ì½”ë“œ
    
    ```jsx
    import { useState } from 'react';
    
    export default function Counter() {
      const [number, setNumber] = useState(0);
    
      return (
        <>
          <h1>{number}</h1>
          <button onClick={() => {
            setNumber(n => n + 1);
            setNumber(n => n + 1);
            setNumber(n => n + 1);
          }}>+3</button>
        </>
      )
    }
    ```
    

ì—¬ê¸°ì„œ `n => n + 1`ì€ ì—…ë°ì´í„° í•¨ìˆ˜(updater function)ë¼ê³  ë¶€ë¥¸ë‹¤. ì´ë¥¼ state ì„¤ì •ì í•¨ìˆ˜ì— ì „ë‹¬í•  ë•Œ,

1. ReactëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì˜ ë‹¤ë¥¸ ì½”ë“œê°€ ëª¨ë‘ ì‹¤í–‰ëœ í›„ì— ì´ í•¨ìˆ˜ê°€ ì²˜ë¦¬ë˜ë„ë¡ íì— ë„£ëŠ”ë‹¤.
2. ë‹¤ìŒ ë Œë”ë§ ì¤‘ì— ReactëŠ” íë¥¼ ìˆœíšŒí•˜ì—¬ ìµœì¢… ì—…ë°ì´íŠ¸ëœ stateë¥¼ ì œê³µí•œë‹¤.

```jsx
setNumber(n => n + 1);
setNumber(n => n + 1);
setNumber(n => n + 1);
```

![Untitled](2-5%20state%20%E1%84%8B%E1%85%A5%E1%86%B8%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%B3%20%E1%84%8F%E1%85%B2%2029703dad541a4c0ab70e35554916af10/Untitled%201.png)

ReactëŠ” `3`ì„ ìµœì¢… ê²°ê³¼ë¡œ ì €ì¥í•˜ê³  `useState`ì—ì„œ ë°˜í™˜í•œë‹¤.

ì´ê²ƒì´ ìœ„ ì˜ˆì œ â€œ+3â€ì„ í´ë¦­í•˜ë©´ ê°’ì´ 3ì”© ì˜¬ë°”ë¥´ê²Œ ì¦ê°€í•˜ëŠ” ì´ìœ ë‹¤.

### stateë¥¼ êµì²´í•œ í›„ ì—…ë°ì´íŠ¸ í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ?

ì´ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ëŠ” ì–´ë–¨ê¹Œ? ë‹¤ìŒ ë Œë”ë§ì—ì„œ `number`ê°€ ì–´ë–»ê²Œ ë ê¹Œ?

```jsx
<button onClick={() => {
  setNumber(number + 5);
  setNumber(n => n + 1);
}}>
```

ì´ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ Reactì—ê²Œ ì§€ì‹œí•˜ëŠ” ì‘ì—…ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

1. `setNumber(number + 5)`: `number`ëŠ” `0` ì´ë¯€ë¡œ `setNumber(0 + 5)`ì´ë‹¤. ReactëŠ” íì— â€œ5ë¡œ ë°”ê¾¸ê¸°â€ë¥¼ ì¶”ê°€í•œë‹¤.
2. `setNumber(n => n+1)` : `n => n+1` ëŠ” ì—…ë°ì´í„° í•¨ìˆ˜ì´ë‹¤. ReactëŠ” í•´ë‹¹ í•¨ìˆ˜ë¥¼ íì— ì¶”ê°€í•œë‹¤.

ë‹¤ìŒ ë Œë”ë§í•˜ëŠ” ë™ì•ˆ ReactëŠ” stateíë¥¼ ìˆœíšŒí•œë‹¤.

![Untitled](2-5%20state%20%E1%84%8B%E1%85%A5%E1%86%B8%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%B3%20%E1%84%8F%E1%85%B2%2029703dad541a4c0ab70e35554916af10/Untitled%202.png)

reactëŠ” `6`ì„ ìµœì¢… ê²°ê³¼ë¡œ ì €ì¥í•˜ê³  `useState`ì—ì„œ ë°˜í™˜í•œë‹¤.

<aside>
ğŸ’¡ ì¤‘ìš”í•¨!

`setState(5)`ê°€ ì‹¤ì œë¡œëŠ” `setState(n => 5)`ì²˜ëŸ¼ ë™ì‘í•˜ì§€ë§Œ `n`ì´ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì„ ëˆˆì¹˜ì±˜ì„ ê²ƒ.

</aside>

### ì—…ë°ì´íŠ¸ í›„ stateë¥¼ ë°”ê¾¸ë©´ ì–´ë–»ê²Œ ë ê¹Œ?

ë‹¤ìŒ ë Œë”ë§ ì˜ˆì—ì„  `number`ê°€ ì–´ë–»ê²Œ ë ê¹Œ?

```jsx
<button onClick={() => {
  setNumber(number + 5);
  setNumber(n => n + 1);
  setNumber(42);
}}>
```

1. `setNumber(number + 5)`: `number`ëŠ” `0`ì´ë¯€ë¡œ `setNumber(0 + 5)`ì´ë‹¤. ReactëŠ” â€œ5ë¡œ ë°”ê¾¸ê¸°â€ë¥¼ íì— ì¶”ê°€í•œë‹¤.
2. `setNumber(n => n+1)` : `n => n +1` ëŠ” ì—…ë°ì´í„° í•¨ìˆ˜ë‹¤. ReactëŠ” í•¨ìˆ˜ë¥¼ íì— ì¶”ê°€í•œë‹¤.
3. `setNumber(42)`: ReactëŠ” â€œ`42`ë¡œ ë°”ê¾¸ê¸°â€ë¥¼ íì— ì¶”ê°€í•œë‹¤.

![Untitled](2-5%20state%20%E1%84%8B%E1%85%A5%E1%86%B8%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%B3%20%E1%84%8F%E1%85%B2%2029703dad541a4c0ab70e35554916af10/Untitled%203.png)

ê·¸ëŸ° ë‹¤ìŒ ReactëŠ” `42`ë¥¼ ìµœì¢… ê²°ê³¼ë¡œ ì €ì¥í•˜ê³  `useState`ì—ì„œ ë°˜í™˜í•œë‹¤.

ìš”ì•½í•˜ìë©´ `setNumber` state ì„¤ì •ì í•¨ìˆ˜ì— ì „ë‹¬í•  ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ì´ ìƒê°í•  ìˆ˜ ìˆë‹¤:

- ì—…ë°ì´í„° í•¨ìˆ˜ (ì˜ˆ. `n => n+1`)ê°€ íì— ì¶”ê°€ëœë‹¤.
- ë‹¤ë¥¸ ê°’ (ì˜ˆ. ìˆ«ì `5`)ì€ íì— â€œ `5` ë¡œ ë°”ê¾¸ê¸°â€ë¥¼ ì¶”ê°€í•˜ë©°, ì´ë¯¸ ì´ì „ íì— ëŒ€ê¸°ì¤‘ì¸ í•­ëª©ì€ ë¬´ì‹œí•œë‹¤.

ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ ì™„ë£Œë˜ë©´ ReactëŠ” ë¦¬ë Œë”ë§ì„ ì‹¤í–‰í•œë‹¤. ë¦¬ë Œë”ë§í•˜ëŠ” ë™ì•ˆ ReactëŠ” íë¥¼ ì²˜ë¦¬í•œë‹¤. ì—…ë°ì´í„° í•¨ìˆ˜ëŠ” ë Œë”ë§ ì¤‘ì— ì‹¤í–‰ë˜ë¯€ë¡œ, ì—…ë°ì´í„° í•¨ìˆ˜ëŠ” ìˆœìˆ˜í•´ì•¼ í•˜ë©° ê²°ê³¼ë§Œ ë°˜í™˜í•´ì•¼ í•œë‹¤. ì—…ë°ì´í„° í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ stateë¥¼ ë³€ê²½í•˜ê±°ë‚˜ ë‹¤ë¥¸ ì‚¬ì´ë“œ ì´í™íŠ¸ë¥¼ ì‹¤í–‰í•˜ë ¤ê³  í•˜ì§€ ë§ë¼. Strictëª¨ë“œì—ì„œ reactëŠ” ê° ì—…ë°ì´í„° í•¨ìˆ˜ë¥¼ ë‘ ë²ˆ ì‹¤í–‰(ë‘ë²ˆì§¸ ê²°ê³¼ëŠ” ë²„ë¦¼)í•˜ì—¬ ì‹¤ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤€ë‹¤.

### ëª…ëª… ê·œì¹™

ì—…ë°ì´í„° í•¨ìˆ˜ ì¸ìˆ˜ì˜ ì´ë¦„ì€ stateë³€ìˆ˜ì˜ ì²« ê¸€ìë¡œ ì§€ì •í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì´ë‹¤.

```jsx
setEnabled(e => !e);
setLastName(ln => ln.reverse());
setFriendCount(fc => fc * 2);
```

ì¢€ ë” ìì„¸í•œ ì½”ë“œë¥¼ ì„ í˜¸í•˜ëŠ” ê²½ìš° `setEnabled(enabled => !enabled)`ì™€ ê°™ì´ ì „ì²´ state ë³€ìˆ˜ ì´ë¦„ì„ ë°˜ë³µí•˜ê±°ë‚˜, `setEnabled(prevEnabled => !prevEnabled)`ì™€ ê°™ì€ ì ‘ë‘ì‚¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” ê·œì¹™ì´ë‹¤.

## ìš”ì•½

- stateë¥¼ ì„¤ì •í•˜ë”ë¼ë„ ê¸°ì¡´ ë Œë”ë§ì˜ ë³€ìˆ˜ëŠ” ë³€ê²½ë˜ì§€ ì•Šìœ¼ë©°, ëŒ€ì‹  ìƒˆë¡œìš´ ë Œë”ë§ì„ ìš”ì²­
- ReactëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ ì‹¤í–‰ì„ ë§ˆì¹œ í›„ state ì—…ë°ì´íŠ¸ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì´ë¥¼ batchingì´ë¼ê³  í•¨.
- í•˜ë‚˜ì˜ ì´ë²¤íŠ¸ì—ì„œ ì¼ë¶€ stateë¥¼ ì—¬ëŸ¬ ë²ˆ ì—…ë°ì´íŠ¸í•˜ë ¤ë©´Â `setNumber(n => n + 1)`Â ì—…ë°ì´í„° í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

## ì±Œë¦°ì§€

[state ì—…ë°ì´íŠ¸ í â€“ React](https://ko.react.dev/learn/queueing-a-series-of-state-updates#challenges)

í•˜ì€

```jsx
export function getFinalState(baseState, queue) {
  let finalState = baseState;

  // TODO: do something with the queue...
  queue.forEach((q) => {
    if(typeof q === 'function') {
      finalState = q(finalState)
    }else {
      finalState = q
    }
  })

  return finalState;
}
```

ì •ë¯¼ 

```jsx
export function getFinalState(baseState, queue) {
  let finalState = baseState;

  // TODO: do something with the queue...
	
	return queue.map((v) => {
		if(typeof v === 'function'){
			return finalState = v(finalState)
		}else{
			return finalState = finalState 
		}
	})

}

```

ì€ì‹

```jsx
export function getFinalState(baseState, queue) {
  let finalState = baseState;

  // TODO: do something with the queue...

  queue.map((qu) => {
    let qui = qu
    if (typeof qu !== 'function') {
      qui = () => qu
    }

    finalState = qui(finalState)
  })

  return finalState;
}

```